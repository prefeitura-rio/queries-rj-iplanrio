version: 2
models :

  - name: mart_frequencia__vw_alunos_aulas
    description: "**Descrição**: Totaliza aulas/tempos que o aluno participou e faltas"
    config:
      materialized: table
    columns:
      - name: id_aluno
        description: Identificador único do aluno (tabela origem ACA_Aluno)
        data_tests:
          - not_null:
              name: marts_sme_frequencia_sme_frequencia__vw_alunos_aulas__id_aluno__not_null
      - name: id_matricula_turma
        description: Identificador único da matrícula do aluno na turma
        data_tests:
          - not_null:
              name: marts_sme_frequencia_sme_frequencia__vw_alunos_aulas__id_matricula_turma__not_null
      - name: id_matricula_disciplina
        description: Identificador único da matrícula do aluno na disciplina em dada turma
      - name: id_disciplina_turma
        description: Identificador único da disciplina na turma
        data_tests:
          - not_null:
              name: marts_sme_frequencia_sme_frequencia__vw_alunos_aulas__id_disciplina_turma__not_null
      - name: id_tipo_calendario
        description: Identificador único do conselho de classe (COC)
      - name: data_aula
        description: Data na qual houve aula realizada e com frequência efetivada pelo professor
        data_tests:
          - not_null:
              name: marts_sme_frequencia_sme_frequencia__vw_alunos_aulas__data_aula__not_null
      - name: falta
        description: Número de faltas no dia (tau_data), nunca maior que o numeroAulas
      - name: taa_frequenciaBitMap
        description: String com o registro de presença e falta (1-falta; 0-presença)
      - name: numeroAulas
        description: Número de aulas ou tempos de aula
      - name: tipo_frequencia_apurada
        description: "Parâmetro que indica se numeroAulas: 1-será o tempo da aula ou 2-se será o dia de aula"
      - name: abonaFalta
        description: Indica que houve abono de falta no dia (0-não abonado; 1-abonado)

  - name: mart_frequencia__vw_alunos_frequencia_acumulada
    description: "**Descrição**: Calcula o indicador de frequência acumulada por aluno a partir do início do ano letivo até a data atual, considerando o período de matrícula do aluno na(s) turma(s). Modelo altamente custoso, proporcional à abrangência do filtro aplicado."
    config:
      materialized: table
    columns:
      - name: id_aluno
        description: Identificador único do aluno
        data_tests:
          - not_null:
              name: marts_frequencia_mart_frequencia__vw_alunos_frequencia_acumulada__id_aluno__not_null
      - name: numero_faltas
        description: Soma total de faltas do aluno no período considerado
      - name: numero_aulas
        description: Soma total do número de aulas/dias do aluno. Para EDI e EF1 é o mesmo que contar o número de linhas. Para EF2 soma tempos de aula por dia
      - name: frequencia_percentual
        description: Percentual de frequência do aluno calculado pela fórmula (100 - (total_faltas / total_aulas) * 100)

  - name: mart_frequencia__frequencia_mensal
    description: "**Descrição**: Frequencia diária dos alunos no ano letivo corrente\n**Frequência de atualização**: Diariamente / À noite\n**Cobertura temporal**: Ano Corrente\n**Órgão gestor dos dados**: Secretaria Municipal de Educação\n"
    config:
      materialized: table
    columns:
    - name: updated_at
      description: "Usado para controle incremental"
    - name: coordenacao_regional
      description: Número da coordenação regional de educação (01 a 11)
    - name: id_turma
      description: Identificador de turma
    - name: id_escola
      description: Identificador da escola na base de dados
    - name: id_secundario_turma
      description: "Código secundário da turma que indica semanticamente a série e a sala. Exemplo: 1701, 1702"
    - name: id_ano_calendario
      description: Identificador do ano calendário do registro da frequência
    - name: tipo_turma
      description: "Tipo de turma: 1 – Turma normal; 2 – Turma eletiva; 6 – Turma treinamento"
    - name: id_disciplina
      description: Código da disciplina da turma
    - name: nome_disciplina
      description: Nome da disciplina da turma
    - name: id_tipo_disciplina
      description: "Identificador de Tipo de disciplina: 1 – Obrigatória; 2 – Estágio; 3 – Optativa; 4 – Eletiva"
    - name: carga_horaria_semanal
      description: Carga horária semanal da disciplina da turma
    - name: id_disciplina_turma
      description: Identificador de disciplina para cada turma
    - name: id_aula_disciplina
      description: "Identificador das aulas da disciplina da turma em determinado dia. Uma aula corresponde a um tempo da disciplina. Este identificador pode corresponder a várias aulas, desde que estejam no mesmo dia."
    - name: id_tipo_calendario
      description: Identificador do COC onde o plano de aula foi realizado
    - name: sequencia_aula
      description: Número da ordem do tempo no plano de aula
    - name: numero_aula
      description: Número de tempo da disciplina no plano de aula de determinado tipo
    - name: plano_aula
      description: Descrição do plano de aula. Contém o conteúdo a ser dado e a dinâmica
    - name: diario_classe
      description: Diário de classe da disciplina da turma. Eventos que aconteceram na turma.
    - name: id_situacao
      description: "Situação do registro: 1 – Aula prevista; 3 – Excluído; 4 – Aula dada; 6 – Aula cancelada"
    - name: efetivado
      description: Indica que o professor realizou o plano de aula. Isto ocorre mesmo que somente um tempo tenha sido dado.
    - name: id_aluno
      description: Identificador do aluno
    - name: id_matricula_turma
      description: Identificador de matrícula do aluno na turma
    - name: id_matricula_disciplina
      description: Identificador de matrícula do aluno para determinada disciplina em uma turma
    - name: id_situacao_aula
      description: "Situação do registro: 1 – Ativo; 3 – Excluído. É excluído quando foram inseridos dados incorretamente."
    - name: faltas_disciplina_dia
      description: Quantidade de faltas do aluno no dia
    - name: frequencia_tempo
      description: Frequência do tempo
    - name: descricao_turno
      description: Descrição do turno
    - name: data_aula
      description: Data do plano de aula
    - name: ano_calendario
      description: Ano do calendário, sempre será o ano vigente
    - name: id_turno
      description: Identificador sequencial do turno
    - name: id_curso
      description: Identificador sequencial do curso

  - name: mart_frequencia__carga_aluno_frequencia
    description: "**Descrição**: Carga horária e frequência dos alunos por disciplina\n**Frequência de atualização**: Diária\n**Cobertura temporal**: Ano corrente\n**Órgão gestor dos dados**: Secretaria Municipal de Educação\n"
    config:
      materialized: table

  - name: mart_frequencia__vw_alunos_frequencia_acumulada_dias_letivos
    description: "**Descrição**: Calcula o indicador de frequência acumulada por aluno considerando apenas os dias letivos, a partir do início do ano letivo até a data atual, considerando o período de matrícula do aluno na(s) turma(s)."
    config:
      materialized: table
  