version: 2

models:
  - name: raw_gcp_bigquery_jobs
    description: "Tabela histórica incremental com todos os jobs do BigQuery extraídos do INFORMATION_SCHEMA.JOBS_BY_PROJECT. Permite auditoria, rastreio, análise de uso e persistência de dados além do retention de 180 dias do BigQuery. Cada linha representa um job executado em um dos projetos monitorados, com informações detalhadas para auditoria, controle de custos e troubleshooting."
    config:
      schema: brutos_gcp
      alias: gcp_bigquery_jobs
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          name: raw_gcp_bigquery_jobs__project_id_job_id__unique
          combination_of_columns:
            - project_id
            - job_id
          severity: error
    columns:
      - name: origem_projeto
        description: "Projeto GCP de origem do job (ex: rj-iplanrio, rj-iplanrio-dev, etc). Indica de qual projeto o job foi extraído para fins de auditoria e rastreabilidade."

      - name: project_id
        description: "ID do projeto GCP onde o job foi executado. Exemplo: 'rj-iplanrio'."
        data_tests:
          - not_null:
              name: raw_gcp_bigquery_jobs__project_id__not_null
              severity: error

      - name: job_id
        description: "Identificador único do job no BigQuery, utilizado para rastreamento e auditoria. Exemplo: 'job_1234567890abcdef'."
        data_tests:
          - not_null:
              name: raw_gcp_bigquery_jobs__job_id__not_null
              severity: error

      - name: user_email
        description: "E-mail do usuário ou conta de serviço responsável pela execução do job. Exemplo: 'usuario@iplanrio.rj.gov.br'. Pode ser nulo em execuções automáticas."

      - name: job_type
        description: "Tipo do job executado (ex: QUERY, LOAD, EXPORT, etc). Indica a natureza da operação realizada no BigQuery."

      - name: query
        description: "Consulta SQL executada pelo job, quando aplicável. Pode ser nulo para jobs que não envolvem SQL diretamente (ex: LOAD, EXPORT)."

      - name: state
        description: "Status final do job (ex: DONE, PENDING, RUNNING, FAILED). Indica o resultado da execução."

      - name: destination_project_id
        description: "ID do projeto de destino dos resultados do job, quando aplicável. Exemplo: 'rj-iplanrio'. Pode ser nulo para jobs sem destino definido."

      - name: destination_dataset_id
        description: "Dataset de destino dos resultados do job, quando aplicável. Exemplo: 'meu_dataset'. Pode ser nulo."

      - name: destination_table_id
        description: "Tabela de destino dos resultados do job, quando aplicável. Exemplo: 'minha_tabela'. Pode ser nulo."

      - name: error_result
        description: "Informação sobre erro do job, quando houver. Estrutura JSON com detalhes do erro. Nulo se o job foi bem-sucedido."

      - name: creation_time
        description: "Data e hora de criação do job (horário UTC). Exemplo: '2024-04-01T12:34:56Z'."

      - name: end_time
        description: "Data e hora de término do job (horário UTC). Exemplo: '2024-04-01T12:35:10Z'. Pode ser nulo se o job ainda está em execução."

      - name: statement_type
        description: "Tipo de statement SQL executado (ex: SELECT, INSERT, UPDATE, DML, DDL). Pode ser nulo para jobs não SQL."

      - name: total_bytes_processed
        description: "Total de bytes processados pelo job. Valor inteiro em bytes. Exemplo: 1048576 para 1 MiB."

      - name: total_bytes_billed
        description: "Total de bytes faturados pelo job. Valor inteiro em bytes. Exemplo: 1048576 para 1 MiB."

      - name: data_faturamento
        description: "Data de faturamento do job (base para partição e auditoria). Formato: 'YYYY-MM-DD'."
